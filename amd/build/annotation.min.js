define(["jquery"],function(a){function b(){return this._instanceID=d(),a("#tutu").val(),this}var c=0,d=function(){return++c};return b.getInstanceCount=function(){return c},b.prototype.getInstanceID=function(){return this._instanceID},b.x=0,b.y=0,b.endx=0,b.endy=0,b.path="",b.toolid=0,b.colour="red",b.tooltype=null,b.tooltypefamille=null,b.id=0,b.cartridgex=0,b.cartridgey=0,b.prototype.init=function(a){this.cartridgex=parseInt(a.cartridgex,10)||0,this.cartridgey=parseInt(a.cartridgey,10)||0,this.colour=a.colour||"red",this.tooltype=a.tooltype,this.id=a.id,this.x=parseInt(a.x,10)||0,this.y=parseInt(a.y,10)||0,this.endx=parseInt(a.endx,10)||0,this.endy=parseInt(a.endy,10)||0,this.path=a.path||"",this.toolid=a.toolid,this.tooltypefamille=this.editor.typetools[this.tooltype.type]},b.prototype.draw=function(){},b.prototype.get_color=function(){var a="black";return a?(a=a.replace("rgb","rgba"),a=a.replace(")",",0.5)")):a=this.colour,a},b.prototype.get_color_cartridge=function(){var a="black";return a?(a=a.replace("rgb","rgba"),a=a.replace(")",",0.5)")):a=this.tooltype.cartridge_color,""===a?this.tooltypefamille.cartridge_color:a},b.prototype.init_div_cartridge_id=function(){var a=(new Date).toJSON().replace(/:/g,"").replace(/\./g,"");this.divcartridge="ct_"+this.tooltype.id+"_"+a},b.prototype.get_div_cartridge=function(a){var b="<div ";b+="id='"+this.divcartridge+"' ",b+="class='assignfeedback_editpdfplus_cartridge' ",b+="style='border-color: "+a+";'> ",b+="</div>";var c=Y.Node.create(b);return this.editor.get("readonly")&&c.on("click",this.view_annot,this),c},b.prototype.get_div_cartridge_label=function(a){var b="<div ";b+="id='"+this.divcartridge+"_cartridge' ",b+="class='assignfeedback_editpdfplus_"+this.tooltypefamille.label+"_cartridge' ",b+=this.editor.get("readonly")&&""===this.get_valref()?"style='border-right:none;padding-right:0px;color:"+a+";' ":"style='border-right-color: "+a+";color:"+a+";' ",b+="> ",b+=this.tooltype.cartridge,b+="</div>";var c=Y.Node.create(b);return c},b.prototype.get_div_input=function(a){var b="<div ";b+="id='"+this.divcartridge+"_display' ",b+="style='color:"+a+"; ",this.editor.get("readonly")&&""===this.get_valref()&&(b+="padding:0px;"),b+="'></div>";var c=Y.Node.create(b);return this.editor.get("readonly")||c.on("click",this.edit_annot,this),c},b.prototype.get_div_edition=function(){var a="<div ";a+="id='"+this.divcartridge+"_edit' ",a+="class='assignfeedback_editpdfplus_"+this.tooltypefamille.label+"_edition' ",a+="style='display:none;'> ",a+="<textarea id='"+this.divcartridge+"_editinput' type='text' value=\""+this.get_valref()+"\" class='form-control' style='margin-bottom:5px;' >"+this.get_valref()+"</textarea>",a+="</div>";var b=Y.Node.create(a),c=this.tooltype.texts;if(c&&c.length>0){for(var d="<div></div>",e=Y.Node.create(d),f=c.split('","'),g=0;g<f.length;g++){var h="<button class='btn btn-default' type='button' style='width:100%;font-size: x-small;'>"+f[g].replace('"',"")+"</button>",i=Y.Node.create(h);i.on("click",this.fill_input_edition,this,f[g].replace('"',"")),e.append(i),e.append("<br/>")}b.append(e)}return b},b.prototype.get_div_container=function(a){var b="<div ";b+="class='assignfeedback_editpdfplus_"+this.tooltypefamille.label+"_conteneur' >",b+="</div>";var c=Y.Node.create(b),d=this.get_div_input(a);d.addClass("assignfeedback_editpdfplus_"+this.tooltypefamille.label+"_input");var e=1;(this.displaylock||this.displaylock>=0)&&(e=this.displaylock);var f=Y.Node.create("<input type='hidden' id='"+this.divcartridge+"_onof' value="+e+" />"),g=this.editor.get("readonly");return g||d.on("click",this.edit_annot,this),c.append(d),c.append(f),c.append(this.get_input_question()),g=this.editor.get("readonly"),g?c.append(this.get_button_student_status()):(c.append(this.get_button_visibility_left()),c.append(this.get_button_visibility_right()),c.append(this.get_button_save()),c.append(this.get_button_cancel()),1===this.tooltype.reply&&c.append(this.get_button_question()),c.append(this.get_button_remove())),c},b.prototype.get_button_visibility_right=function(){var a="<button id='"+this.divcartridge+"_buttonedit_right' class='btn btn-default' type='button'>";a+="<i class='fa fa-arrow-right' aria-hidden='true'></i>",a+="</button>";var b=Y.Node.create(a);return b.on("click",this.change_visibility_annot,this,"r"),b},b.prototype.get_button_visibility_left=function(){var a="<button id='"+this.divcartridge+"_buttonedit_left' class='btn btn-default' type='button'>";a+="<i class='fa fa-arrow-left' aria-hidden='true'></i>",a+="</button>";var b=Y.Node.create(a);return b.on("click",this.change_visibility_annot,this,"l"),b},b.prototype.get_button_cancel=function(){var a="<button id='"+this.divcartridge+"_buttoncancel' style='display:none;' class='btn btn-default' type='button'><i class='fa fa-undo' aria-hidden='true'></i></button>",b=Y.Node.create(a);return b.on("click",this.cancel_edit,this),b},b.prototype.get_button_question=function(){var a="<button id='"+this.divcartridge+'_buttonquestion\' style=\'display:none;margin-left:10px;\' class=\'btn btn-default\' type=\'button\'><span class="fa-stack fa-lg" style="line-height: 1em;width: 1em;"><i class="fa fa-question-circle-o fa-stack-1x"></i><i class="fa fa-ban fa-stack-1x text-danger"></i></span></button>',b=Y.Node.create(a);return b.on("click",this.change_question_status,this),b},b.prototype.get_button_remove=function(){var a="<button id='"+this.divcartridge+"_buttonremove' style='display:none;margin-left:10px;' class='btn btn-default' type='button'><i class='fa fa-trash' aria-hidden='true'></i></button>",b=Y.Node.create(a);return b.on("click",this.remove_by_trash,this),b},b.prototype.apply_visibility_annot=function(){var a=this.editor.get_dialogue_element("#"+this.divcartridge+"_display"),b=this.editor.get_dialogue_element("#"+this.divcartridge+"_onof"),c=this.editor.get_dialogue_element("#"+this.divcartridge+"_buttonedit_right"),d=this.editor.get_dialogue_element("#"+this.divcartridge+"_buttonedit_left"),e=this.editor.get_dialogue_element("#"+this.divcartridge+"_radioContainer");b&&("1"===b.get("value")?(c&&c.show(),d&&d.show()):"0"===b.get("value")?(c&&c.show(),d&&d.hide()):(c&&c.hide(),d&&d.show())),a&&a.setContent(this.get_text_to_diplay_in_cartridge()),"frame"===this.tooltypefamille.label&&c&&(c.hide(),d.hide()),e&&e.hide(),this.apply_question_status()},b.prototype.get_text_to_diplay_in_cartridge=function(){var a=this.get_valref(),b=this.editor.get_dialogue_element("#"+this.divcartridge+"_onof"),c="";return""!==a||this.editor.get("readonly")||(c="&nbsp;&nbsp;&nbsp;&nbsp"),"1"===b.get("value")&&""!==a?c=a.substr(0,20):"0"===b.get("value")&&""!==a?c="...":""!==a&&(c=a),1===this.answerrequested&&(c+='&nbsp;<span style="color:red;">[?]</span>'),c},b.prototype.apply_question_status=function(){var a=this.editor.get_dialogue_element("#"+this.divcartridge+"_buttonquestion"),b=this.editor.get_dialogue_element("#"+this.divcartridge+"_question"),c=0;b&&(c=parseInt(b.get("value"),10)),a&&(1===c?a.setHTML('<i class="fa fa-question-circle-o"></i>'):a.setHTML('<span class="fa-stack fa-lg" style="line-height: 1em;width: 1em;"><i class="fa fa-question-circle-o fa-stack-1x"></i><i class="fa fa-ban fa-stack-1x text-danger"></i></span>'))},b.prototype.draw_catridge=function(){return!0},b.prototype.edit_annot=function(){if(!this.parent_annot_element){var a=this.editor.get_dialogue_element("#"+this.divcartridge),b=this.editor.get_dialogue_element("#"+this.divcartridge+"_display"),c=this.editor.get_dialogue_element("#"+this.divcartridge+"_edit"),d=this.editor.get_dialogue_element("#"+this.divcartridge+"_buttonedit_right"),e=this.editor.get_dialogue_element("#"+this.divcartridge+"_buttonedit_left"),f=this.editor.get_dialogue_element("#"+this.divcartridge+"_buttonsave"),g=this.editor.get_dialogue_element("#"+this.divcartridge+"_buttoncancel"),h=this.editor.get_dialogue_element("#"+this.divcartridge+"_buttonquestion"),i=this.editor.get_dialogue_element("#"+this.divcartridge+"_buttonrotation"),j=this.editor.get_dialogue_element("#"+this.divcartridge+"_buttonremove"),k=this.editor.get_dialogue_element("#"+this.divcartridge+"_editinput");b.hide(),d&&d.hide(),e&&e.hide(),i&&i.hide(),c.show(),f.show(),g.show(),h&&h.show(),j.show(),a.setStyle("z-index",1e3),k&&k.set("focus","on"),this.disabled_canvas_event(),a.on("clickoutside",this.save_annot_clickout,this,"clickoutside")}},b.prototype.fill_input_edition=function(a,b){var c=this.editor.get_dialogue_element("#"+this.divcartridge+"_editinput");c&&c.set("value",b),this.save_annot(b)},b.prototype.save_annot_clickout=function(a,b){"clickoutside"===b&&this.editor.currentannotation===this||this.save_annot(null)},b.prototype.save_annot=function(a){if("string"!=typeof a){var b=this.editor.get_dialogue_element("#"+this.divcartridge+"_editinput");b&&(a=b.get("value"))}this.textannot=a,this.editor.save_current_page(),0===a.length&&(a="&nbsp;&nbsp;"),this.hide_edit(),this.apply_visibility_annot()},b.prototype.cancel_edit=function(a,b){if("clickoutside"!==b||this.editor.currentannotation!==this){var c=this.get_valref(),d=this.editor.get_dialogue_element("#"+this.divcartridge+"_editinput");c&&d&&d.set("value",c),this.hide_edit(),this.apply_visibility_annot();var e=this.editor.get_dialogue_element("#"+this.divcartridge);e&&e.detach()}},b.prototype.hide_edit=function(a,b){if(!b||"clickoutside"!==b||this.editor.currentannotation!==this){var c=this.editor.get_dialogue_element("#"+this.divcartridge),d=this.editor.get_dialogue_element("#"+this.divcartridge+"_display"),e=this.editor.get_dialogue_element("#"+this.divcartridge+"_edit"),f=this.editor.get_dialogue_element("#"+this.divcartridge+"_visu"),g=this.editor.get_dialogue_element("#"+this.divcartridge+"_buttonsave"),h=this.editor.get_dialogue_element("#"+this.divcartridge+"_buttoncancel"),i=this.editor.get_dialogue_element("#"+this.divcartridge+"_buttonquestion"),j=this.editor.get_dialogue_element("#"+this.divcartridge+"_buttonrotation"),k=this.editor.get_dialogue_element("#"+this.divcartridge+"_buttonremove"),l=this.editor.get_dialogue_element("#"+this.divcartridge+"_radioContainer");d&&(d.show(),d.set("style","display:inline;color:"+this.get_color_cartridge()+";")),j&&j.show(),e&&(e.hide(),g.hide(),h.hide()),f&&f.hide(),i&&i.hide(),k&&k.hide(),c&&(c.setStyle("z-index",1),c.detach(),this.editor.get("readonly")&&c.on("click",this.view_annot,this,"click")),e&&this.enabled_canvas_event(),l&&l.hide()}},b});